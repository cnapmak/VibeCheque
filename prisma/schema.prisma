// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Venue {
  id          String   @id @default(cuid())
  name        String
  address     String
  city        String
  state       String
  country     String   @default("US")
  website     String?
  phone       String?
  imageUrl    String?
  latitude    Float?
  longitude   Float?
  type          String   @default("RESTAURANT")
  neighborhood  String?

  // AI Vibe Analysis
  vibeCategory  String?
  vibeSummary   String?
  vibeScore     Float?
  vibeAnalyzedAt DateTime?

  // Aggregate stats
  avgUserVibeScore Float?
  reviewCount      Int       @default(0)

  reviews     Review[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Review {
  id          String   @id @default(cuid())
  venueId     String
  venue       Venue    @relation(fields: [venueId], references: [id], onDelete: Cascade)

  authorName  String
  authorEmail String?

  vibeRating    Int
  vibeCategory  String?
  comment       String
  visitedAt     DateTime?

  upvotes     Int @default(0)
  downvotes   Int @default(0)

  votes       Vote[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Vote {
  id       String    @id @default(cuid())
  reviewId String
  review   Review    @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  voterIp  String
  voteType String

  @@unique([reviewId, voterIp])
}
